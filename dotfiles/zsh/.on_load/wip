build_with_pats() {
  PATH=$1
  NAME=$2
  docker build -t $NAME --build-arg GITLAB_PAT=$GITLAB_PAT --build-arg GITHUB_PAT=$GITHUB_PAT $PATH
}

# PROJ_PATH="$HOME/Projects/IXIS"
# build_with_pats "$PROJ_PATH/ixis.data-science-services/shiny/Apps/client=NS/shiny_app/dev" test

# i) image
# e) entrypoint - defaults to sh
# p) path for .aws folder - defaults to /home/root/
# n) name of container
docker_aws() {
    # get args
    while getopts ":i:e:p:n:" opt; do
        case $opt in
            i) IMAGE="$OPTARG"
            ;;
            e) ENTRYPOINT="$OPTARG"
            ;;
            p) AWS_PATH="$OPTARG"
            ;;
            n) CONTAINER_NAME="$OPTARG"
            ;;
            \?) echo "Invalid option -$OPTARG" >&2
            exit 1
            ;;
        esac
        case $OPTARG in
            -*) echo "Option $opt needs a valid argument"
            exit 1
            ;;
        esac
    done

    # fix args if not provided
    if [[ -z "$IMAGE" ]]
    then echo "No image provided"
    fi

    if [[ -z "$ENTRYPOINT" ]]
    then ENTRYPOINT="sh"
    fi

    if [[ -z "$AWS_PATH" ]]
    then AWS_PATH="/home/root"
    fi

    if [[ -z "$CONTAINER_NAME" ]]
    then NAME_COMMAND="--name $CONTAINER_NAME"
    else NAME_COMMAND=""
    fi

    # docker run
    docker run --rm \
        -v $HOME/.aws:$AWS_PATH/.aws \
        -e STAGE=$STAGE
        -e AWS_ACCOUNT_ID=$AWS_ACCOUNT_ID \
        -e AWS_DEFAULT_PROFILE=$AWS_DEFAULT_PROFILE \
        -e AWS_PROFILE=$AWS_PROFILE -e AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION \
        -e AWS_SDK_LOAD_CONFIG=$AWS_SDK_LOAD_CONFIG \
        -it $NAME_COMMAND $IMAGE
}
